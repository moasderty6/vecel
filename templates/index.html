<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto bot | بوت تحليل العملات</title>
<style>
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background:linear-gradient(135deg,#1e3c72,#2a5298); color:#fff; font-size:14px; }
.container { max-width:800px; margin:30px auto; padding:25px; background-color:rgba(0,0,0,0.5); border-radius:20px; box-shadow:0 8px 20px rgba(0,0,0,0.6); text-align:center; }
.bot-image { width:150px; height:150px; border-radius:30px; object-fit:cover; margin-bottom:15px; border:3px solid #ffd700; box-shadow:0 5px 15px rgba(0,0,0,0.5); }
.bot-title { font-size:1.6rem; color:#ffd700; margin-bottom:20px; text-shadow:1px 1px 5px #000; }
.lang-buttons { display:flex; justify-content:center; gap:15px; margin-bottom:20px; flex-wrap:wrap; }
.lang-buttons button { padding:10px 25px; border-radius:20px; border:none; cursor:pointer; background: rgba(255,255,255,0.2); color:#fff; font-weight:bold; transition:0.3s; }
.lang-buttons button.selected { background: rgba(255,255,255,0.5); color:#000; }
.input-group { display:none; flex-direction:column; align-items:center; gap:15px; margin-bottom:15px; }
.input-group input[type=text] { padding:10px 15px; border-radius:12px; border:none; font-size:1rem; width:250px; }
.time-buttons { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
.btn-time { padding:10px 15px; border-radius:12px; border:none; cursor:pointer; background: rgba(255,255,255,0.2); color:#fff; font-weight:bold; transition:0.3s; }
.btn-time.selected { background: rgba(255,255,255,0.5); color:#000; }
.start-analyze { display:inline-block; padding:12px 30px; font-size:1rem; font-weight:bold; color:#fff; background: rgba(255,255,255,0.1); border-radius:20px; border:2px solid rgba(255,255,255,0.3); backdrop-filter:blur(10px); cursor:pointer; transition:0.3s; margin-bottom:15px; display:none; }
.start-analyze:hover { background: rgba(255,255,255,0.3); color:#000; transform:scale(1.05); }
#result { text-align:left; background: rgba(255,255,255,0.1); padding:15px; border-radius:15px; min-height:120px; max-height:400px; overflow-y:auto; display:none; }
</style>
</head>
<body>

<div class="container">
    <img class="bot-image" src="https://i.postimg.cc/NMY0c6Nf/IMG-4506.jpg" alt="Bot Image">
    <div class="bot-title">Crypto bot | بوت تحليل العملات</div>

    <div class="lang-buttons">
        <button data-lang="ar">🇸🇦 العربية</button>
        <button data-lang="en">🇺🇸 English</button>
    </div>

    <div class="input-group" id="currencyGroup">
        <input type="text" id="symbol" placeholder="رمز العملة مثل BTC">
        <div class="time-buttons">
            <button class="btn-time" data-time="1D">1D</button>
            <button class="btn-time" data-time="1W">1W</button>
            <button class="btn-time" data-time="1M">1M</button>
        </div>
    </div>

    <button class="start-analyze" id="analyzeBtn">تحليل العملة</button>
    <div id="result"></div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;
tg.expand();

let selectedLang = null;
let selectedTime = "1W";

const langButtons = document.querySelectorAll(".lang-buttons button");
langButtons.forEach(btn=>{
    btn.addEventListener("click",()=>{
        langButtons.forEach(b=>b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedLang = btn.getAttribute("data-lang");

        // تعديل placeholder حسب اللغة
        document.getElementById("symbol").placeholder = selectedLang==="ar"?"رمز العملة مثل BTC":"Enter coin symbol e.g. BTC";

        document.getElementById("currencyGroup").style.display = "flex";
        document.getElementById("analyzeBtn").style.display = "inline-block";
        document.getElementById("result").style.display = "block";
    });
});

// أزرار الإطار الزمني
const timeButtons = document.querySelectorAll(".btn-time");
timeButtons.forEach(btn=>{
    btn.addEventListener("click",()=>{
        timeButtons.forEach(b=>b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedTime = btn.getAttribute("data-time");
    });
});

// زر التحليل
document.getElementById("analyzeBtn").addEventListener("click", async ()=>{
    const symbol = document.getElementById("symbol").value.trim();
    if(!symbol){ alert(selectedLang==="ar"?"الرجاء إدخال رمز العملة":"Please enter coin symbol"); return; }
    const userId = tg.initDataUnsafe.user.id;

    document.getElementById("result").innerHTML = selectedLang==="ar"?"⏳ جاري التحليل...":"⏳ Analyzing...";

    try {
        const res = await fetch("/analyze",{
            method:"POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({symbol:symbol, timeframe:selectedTime, user_id:userId, lang:selectedLang})
        });
        const data = await res.json();
        if(data.status === "ok"){
            document.getElementById("result").innerHTML = 
                (selectedLang==="ar"?"<b>السعر الحالي:</b> $":"<b>Current Price:</b> $") 
                + data.price.toFixed(6) 
                + "<br><pre>" + data.analysis + "</pre>";
        } else {
            document.getElementById("result").innerHTML = data.msg;
        }
    } catch(e){
        document.getElementById("result").innerHTML = selectedLang==="ar"?"❌ حدث خطأ أثناء التحليل":"❌ Analysis failed";
        console.error(e);
    }
});
</script>

</body>
</html>
